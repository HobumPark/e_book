<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../css/book.css">
    <title>ì±…</title>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/turn.min.js"></script>
    <script type="text/javascript">
        let data = null; // ì „ì—­ ë°ì´í„° ë³€ìˆ˜
        let synth = null; // ìŒì„± í•©ì„± ê°ì²´
    
        $(document).ready(function () {
            // ì±… í˜ì´ì§€ ë„˜ê¸°ê¸°
            $("#book").turn({
                when: {
                    turned: function (event, page, view) {
                        // í˜ì´ì§€ê°€ ë„˜ì–´ê°€ë©´ í˜„ì¬ í˜ì´ì§€ ìƒíƒœ ì—…ë°ì´íŠ¸
                        currentPage = page;
                    }
                }
            });
    
            // ì²˜ìŒì— ë°ì´í„° ë¡œë“œ
            data_load("showpen.json");
        });
    
        function data_load(file) {
            $.getJSON(`./data/${file}`, function (json) {
                data = json;
                console.log("ë°ì´í„° ë¡œë“œ ì™„ë£Œ", data);
                contents1Display(data.contents1);
                contents2Display(data.contents2);
            }).fail(function () {
                console.log("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜ ë°œìƒ");
            });
        }
    
        function contents1Display(data) {
            $("#page1-inner>h1").text(data.title);
            const page1 = data.contents.page1;
            const page2 = data.contents.page2;
            $("#page1-inner>#contents").html(generateTextWithSpeaker(page1));
            $("#page2-inner>#contents").html(generateTextWithSpeaker(page2));
        }
    
        function contents2Display(data) {
            $("#page3-inner>h1").text(data.title);
            const page3 = data.contents.page3;
            const page4 = data.contents.page4;
            $("#page3-inner>#contents").html(generateTextWithSpeaker(page3));
            $("#page4-inner>#contents").html(generateTextWithSpeaker(page4));
        }
    
        // í…ìŠ¤íŠ¸ ë¼ì¸ì— ìŠ¤í”¼ì»¤ ì•„ì´ì½˜ ì¶”ê°€
        function generateTextWithSpeaker(lines) {
            return lines.map((line, index) => {
                return `<div class="text-line" data-index="${index}">
                            ${line} <span class="speaker-icon" data-index="${index}">ğŸ”Š</span>
                        </div>`;
            }).join("<br>");
        }
    
        // ì˜¤ë””ì˜¤ ë¶ ì½ê¸° ì‹œì‘
        function startReading(text) {
            if (!('speechSynthesis' in window)) {
                alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± í•©ì„±ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                return;
            }
    
            synth = window.speechSynthesis;
            synth.cancel(); // ì´ì „ ìŒì„± ë©ˆì¶”ê¸°
    
            const utter = new SpeechSynthesisUtterance(text);
            utter.lang = "ko-KR";
            utter.rate = 1;
            synth.speak(utter);
        }
    
        // í…ìŠ¤íŠ¸ ë¼ì¸ í´ë¦­ ì‹œ í•´ë‹¹ í…ìŠ¤íŠ¸ ì½ê¸°
        $(document).on('click', '.speaker-icon', function() {
            const index = $(this).data('index');
            let pageContents = [];
            
            if (index < data.contents1.contents.page1.length) {
                pageContents = data.contents1.contents.page1;
            } else if (index < data.contents1.contents.page1.length + data.contents1.contents.page2.length) {
                pageContents = data.contents1.contents.page2;
            } else if (index < data.contents1.contents.page1.length + data.contents1.contents.page2.length + data.contents2.contents.page3.length) {
                pageContents = data.contents2.contents.page3;
            } else {
                pageContents = data.contents2.contents.page4;
            }

            // í•´ë‹¹ í˜ì´ì§€ì˜ í…ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì™€ì„œ ì½ê¸°
            startReading(pageContents[index]);
        });
    </script>
    <style>
        .speaker-icon {
            cursor: pointer;
            margin-left: 10px;
            font-size: 20px;
        }

        .text-line {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div id="controls">
        <!-- ì˜¤ë””ì˜¤ ë¶ ì½ê¸° ë²„íŠ¼ì€ í•„ìš”ì—†ìŒ, ê° ì¤„ì— ìŠ¤í”¼ì»¤ ì•„ì´ì½˜ì„ í´ë¦­í•´ì„œ ì½ê¸° -->
    </div>

    <div id="book">
        <div>
            <img src="../images/showpen.jpg" alt="ì±… í‘œì§€"/>
        </div>
        <div id="page1">
            <span id="page1-inner">
                <h1 id="title"></h1>
                <span id="contents"></span>
            </span>
        </div>
        <div id="page2">
            <span id="page2-inner">
                <h1 id="title"></h1>
                <span id="contents"></span>
            </span>
        </div>
        <div id="page3">
            <span id="page3-inner">
                <h1 id="title"></h1>
                <span id="contents"></span>
            </span>
        </div>
        <div id="page4">
            <span id="page4-inner">
                <h1 id="title"></h1>
                <span id="contents"></span>
            </span>
        </div>
    </div>
</body>
</html>
